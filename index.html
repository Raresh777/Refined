<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leads Summary</title>
  <style>
    body {
      font-family: 'Orbitron', sans-serif; /* Futuristic font */
      background-color: #121212; /* Dark background */
      color: #00FFCC; /* Neon green text */
      text-align: center;
      padding: 40px;
    }
    
    h1 {
      color: #00FFFF; /* Bright blue title */
      text-shadow: 0 0 10px #00FFFF, 0 0 20px #00FFFF;
      margin-bottom: 30px;
      font-size: 42px;
    }
    
    label, select, button, input[type="file"] {
      color: #00FFCC;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #00FFFF;
      padding: 10px;
      border-radius: 10px;
      margin: 10px;
      font-size: 18px;
      text-shadow: 0 0 5px #00FFFF;
      transition: 0.3s ease;
    }
    
    input[type="file"] {
      cursor: pointer;
    }
    
    button {
      cursor: pointer;
      border: 2px solid #00FFFF;
      box-shadow: 0 0 10px #00FFFF;
      display: inline-block;
      margin-right: 10px;
    }

    button:hover {
      background-color: #00FFFF;
      color: #121212;
      box-shadow: 0 0 20px #00FFFF, 0 0 30px #00FFFF;
    }
    
    #results {
      margin-top: 30px;
      padding: 20px;
      background-color: #222222;
      border-radius: 10px;
      box-shadow: 0 0 20px #00FFFF;
      display: inline-block;
      text-align: left;
      width: 80%;
    }
    
    .result-section {
      margin-bottom: 20px;
    }

    ul {
      list-style: none;
      padding-left: 0;
    }

    li {
      font-size: 18px;
    }

    #buttons-container {
      display: flex;
      justify-content: center;
    }
  </style>
</head>
<body>

  <h1>Leads Summary by Date</h1>

  <!-- File upload input and date selector side by side -->
  <div id="buttons-container">
    <input type="file" id="csvFileInput" accept=".csv" />
    <label for="dateSelector">Select Date:</label>
    <select id="dateSelector" style="max-width: 200px;"></select>
  </div>

  <!-- Show Summary Button -->
  <div id="buttons-container">
    <button onclick="processLeads()">Show Leads Summary</button>
  </div>

  <!-- Results Section -->
  <div id="results" style="display:none;">
    <h2>Results for <span id="selectedDate"></span></h2>

    <div class="result-section">
      <h3>Total Leads: <span id="totalLeads"></span></h3>
    </div>

    <div class="result-section">
      <h3>Leads by Location</h3>
      <ul id="locationBreakdown"></ul>
    </div>

    <div class="result-section">
      <h3>Leads by First Language</h3>
      <ul id="languageBreakdown"></ul>
    </div>
  </div>

  <script>
    let leadsData = [];
    let dateOptions = new Set();

    function loadCSV(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      
      reader.onload = function (e) {
        const text = e.target.result;
        const lines = text.split('\n');
        const headers = lines[0].split(',');

        // Indices for the columns we need (based on your request, date is at column D (index 3))
        const dateIdx = headers.indexOf('Submission date');
        const emailIdx = headers.indexOf('Email');
        const phoneIdx = headers.indexOf('Phone Number');
        const locationIdx = headers.indexOf('Location');
        const languageIdx = headers.indexOf('Languages');

        // Extract leads data and populate leadsData array
        leadsData = lines.slice(1).map(line => {
          const fields = line.split(',');
          return {
            date: fields[dateIdx]?.trim(), // Ensure date is trimmed and clean
            email: fields[emailIdx]?.trim(),
            phone: fields[phoneIdx]?.trim(),
            location: fields[locationIdx]?.trim(),
            language: fields[languageIdx]?.split(',')[0]?.trim() // Extract only the first language
          };
        });

        // Populate date selector with unique dates
        dateOptions = new Set(leadsData.map(lead => lead.date).filter(date => date)); // Ensure no empty dates
        populateDateSelector();
      };
      
      reader.readAsText(file);
    }

    function populateDateSelector() {
      const dateSelector = document.getElementById('dateSelector');
      dateSelector.innerHTML = ''; // Clear the options

      // Populate unique dates into the selector
      dateOptions.forEach(date => {
        const option = document.createElement('option');
        option.value = date;
        option.text = date;
        dateSelector.appendChild(option);
      });

      if (!dateSelector.options.length) {
        const option = document.createElement('option');
        option.value = '';
        option.text = 'No valid dates found';
        dateSelector.appendChild(option);
      }
    }

    function processLeads() {
      const selectedDate = document.getElementById('dateSelector').value;
      const resultsDiv = document.getElementById('results');
      document.getElementById('selectedDate').textContent = selectedDate;

      if (!selectedDate) {
        alert('Please select a date.');
        return;
      }

      // Filter leads by selected date and ensure uniqueness using email or phone number
      const leadsForSelectedDate = leadsData.filter(
        (lead, index, self) => 
          lead.date === selectedDate &&
          index === self.findIndex(l => l.email === lead.email || l.phone === lead.phone)
      );

      // Count total leads
      document.getElementById('totalLeads').textContent = leadsForSelectedDate.length;

      // Count leads by location
      const locationCount = {};
      leadsForSelectedDate.forEach(lead => {
        locationCount[lead.location] = (locationCount[lead.location] || 0) + 1;
      });

      const locationBreakdown = document.getElementById('locationBreakdown');
      locationBreakdown.innerHTML = ''; // Clear previous results
      for (const [location, count] of Object.entries(locationCount)) {
        const listItem = document.createElement('li');
        listItem.textContent = `${location}: ${count}`;
        locationBreakdown.appendChild(listItem);
      }

      // Count leads by first language
      const languageCount = {};
      leadsForSelectedDate.forEach(lead => {
        languageCount[lead.language] = (languageCount[lead.language] || 0) + 1;
      });

      const languageBreakdown = document.getElementById('languageBreakdown');
      languageBreakdown.innerHTML = ''; // Clear previous results
      for (const [language, count] of Object.entries(languageCount)) {
        const listItem = document.createElement('li');
        listItem.textContent = `${language}: ${count}`;
        languageBreakdown.appendChild(listItem);
      }

      resultsDiv.style.display = 'block';
    }

    document.getElementById('csvFileInput').addEventListener('change', loadCSV);
  </script>

</body>
</html>
